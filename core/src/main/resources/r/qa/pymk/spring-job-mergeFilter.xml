<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:batch="http://www.springframework.org/schema/batch"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/batch 
		http://www.springframework.org/schema/batch/spring-batch-2.1.xsd
		http://www.springframework.org/schema/context 
		http://www.springframework.org/schema/context/spring-context-3.1.xsd
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

	<description>
		PYMK -- Merge And Filter
	</description>

	<bean id="pymkMFJobConf" class="com.tianji.r.core.conf.HiveJobConf">
		<property name="hiveQuerys">
			<list>
				<value>
					<![CDATA[
						INSERT OVERWRITE TABLE r_address_book
					 	SELECT ab.user_id a,a.id b
						FROM o_address_books ab JOIN o_accounts a ON ab.email=a.email
						ORDER BY a
					]]>
				</value>
			</list>
		</property>
		<property name="exportHiveTable">
			<list>
				<value>r_address_book</value>
			</list>
		</property>
		<property name="exportResultTable">
			<list>
				<value>r_address_book</value>
			</list>
		</property>
	</bean>

	<bean id="mergeHiveAlgorithmTask" class="com.tianji.r.core.job.task.HiveAlgorithmTask">
		<property name="jobConf" ref="pymkMFJobConf" />
		<property name="hiveTemplate" ref="rHiveTemplate" />
	</bean>
	
	<bean id="filterHiveAlgorithmTask" class="com.tianji.r.core.job.task.HiveAlgorithmTask">
		<property name="jobConf" ref="pymkMFJobConf" />
		<property name="hiveTemplate" ref="rHiveTemplate" />
	</bean>
	
<!-- 
	<bean id="exportHiveResultTask" class="com.tianji.r.core.job.task.ExportHiveResultTask">
		<property name="jobConf" ref="addressBookJobConf" />
		<property name="dataSource" ref="resultDataSource" />
		<property name="hiveSource" ref="rHiveSource" />
	</bean>

	<batch:job id="addressBookJob">
		<batch:step id="transformDataStep" next="importIntoHiveStep">
			<batch:tasklet ref="transformDataTask" />
		</batch:step>

		<batch:step id="importIntoHiveStep" next="addressBookAlgorithmStep">
			<batch:tasklet ref="importIntoHiveTask" />
		</batch:step>

		<batch:step id="addressBookAlgorithmStep" next="exportResultStep">
			<batch:tasklet ref="addressBookHiveAlgorithmTask" />
		</batch:step>

		<batch:step id="exportResultStep">
			<batch:tasklet ref="exportHiveResultTask" />
		</batch:step>
	</batch:job> -->

</beans>
