<etl>

	<ssh id='s1' username="" password="" ip="" port=""/>
	<ssh id='s2' username="" password="" ip="" port=""/>
	<datasource id="m1" username="" passowrd="" url="" driver=""/>
	<datasource id="m2" username="" passowrd="" url="" driver=""/>
	<hive id='h1' username="" password="" ip="" port=""/>
	
	<export id="p1" ds="m1" output="/tmp/m1.csv">
		<script>
			<![CDATA[
			select id,account_id,b_type, trim(' ' from trim('\t ' from name))
			from backgrounds
			where name is not null and trim(' ' from trim('\t ' from name)) is not null
			into outfile '/tmp/backgrounds.csv'
			fields terminated by ',' optionally enclosed by '"' escaped by '"'
			lines terminated by '\r\n';
			]]>
		</script>
	</export>
	
	<scp id="p2" srcSSH="s1" srcFile="/tmp/m1.csv" distSSH="s2" distFie="/mysql/m1.csv"/> 
	
	<import id="p3" ds="m2" file="/mysql/m1.csv">
		<script>
			<![CDATA[
			LOAD DATA INFILE 'friendships.csv'
			REPLACE INTO TABLE t_user_relate2
			FIELDS TERMINATED BY ',' ENCLOSED BY '"' ESCAPED BY '"'
			LINES TERMINATED BY '\r\n';
			]]>
		</script>
	</import>
	
	<transform id="p4" ds="m2">
		<sql>
			create table t_user_company_md5 as
			select uid,md5(trim('\t ' from bg)) as company
			from t_user_bg b,t_user_active a
			where b.uid=a.user_id and type='c' and bg != '';
		</sql>
	</transform>
	
	<load id="p5" ds="m2" hive="h1">
		<script>
			sqoop import --connect jdbc:mysql://localhost:3306/test --username root --password mysql-password --table t1 --hive-import
		</script>
	</load>
	
</etl>